<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>FortuneBear</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=SUIT:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <div class="app">

    <!-- 캐릭터 영역 -->
    <div class="bear-area">
      <!-- 나중에 곰 이미지 교체 -->
      <img src="bear.png" alt="Fortune Bear" class="bear-image" />
    </div>

    <!-- 텍스트 영역 -->
    <div class="content">
      <h1 class="title">포춘베어</h1>
      <p class="subtitle">
        오늘 하루,<br />
        조심해야 할 것 하나만 말해준다
      </p>

      <button id="btn" class="main-button">
        오늘의 리스크 보기
      </button>

      <div id="result" class="result-box"></div>

      <div class="limit-info">
        하루 최대 3회
      </div>
    </div>

  </div>

  <script>
    const btn = document.getElementById('btn');
    const result = document.getElementById('result');

    const LIMIT = 3;
    const today = new Date().toISOString().slice(0, 10);

    function getUsage() {
      const saved = localStorage.getItem('fortuneBearUsage');
      if (!saved) return { date: today, count: 0 };

      const data = JSON.parse(saved);
      if (data.date !== today) return { date: today, count: 0 };

      return data;
    }

    function saveUsage(data) {
      localStorage.setItem('fortuneBearUsage', JSON.stringify(data));
    }

    btn.addEventListener('click', async () => {
      let usage = getUsage();

      if (usage.count >= LIMIT) {
        result.textContent = '오늘은 여기까지다.\n내일 다시 와라.';
        return;
      }

      usage.count += 1;
      saveUsage(usage);

      result.textContent = '포춘베어가 생각 중이다...';

      try {
        const res = await fetch(
          'https://fortune-bear-backend.onrender.com/api/risk',
          { method: 'POST' }
        );

        const data = await res.json();
        result.textContent = data.result;

      } catch (e) {
        result.textContent = '지금은 말해줄 수 없다.';
      }
    });
  </script>

</body>
</html>
