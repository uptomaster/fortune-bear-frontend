<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>FortuneBear</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=SUIT:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- 배경 오라 -->
  <div class="background-glow"></div>

  <div class="app">

    <!-- 로고 / 캐릭터 영역 -->
    <div class="bear-area">
      <video
        class="bear-video"
        src="bear-loop.mp4"
        autoplay
        muted
        loop
        playsinline
      ></video>
    </div>

    <!-- 콘텐츠 영역 -->
    <div class="content">
      <h1 class="title">포춘베어</h1>

      <p class="subtitle">
        오늘의 운세는 말하지 않는다.<br />
        오늘의 <strong>리스크</strong>만 알려준다.
      </p>

      <!-- 사용 횟수 -->
      <div class="usage-indicator">
        <span id="usage-count">0</span> / 3
      </div>

      <button id="btn" class="main-button">
        오늘의 리스크 보기
      </button>

      <div id="result" class="result-box"></div>

      <div class="limit-info">
        하루 최대 3회 · 자정 초기화
      </div>
    </div>

  </div>

  <script>
    const btn = document.getElementById('btn');
    const result = document.getElementById('result');
    const usageCountEl = document.getElementById('usage-count');

    const LIMIT = 5;
    const today = new Date().toISOString().slice(0, 10);

    function getUsage() {
      const saved = localStorage.getItem('fortuneBearUsage');
      if (!saved) return { date: today, count: 0 };

      const data = JSON.parse(saved);
      if (data.date !== today) return { date: today, count: 0 };

      return data;
    }

    function saveUsage(data) {
      localStorage.setItem('fortuneBearUsage', JSON.stringify(data));
    }

    function updateUsageUI(count) {
      usageCountEl.textContent = count;
    }

    let usage = getUsage();
    updateUsageUI(usage.count);

    btn.addEventListener('click', async () => {
      usage = getUsage();

      if (usage.count >= LIMIT) {
        result.classList.add('show');
        result.textContent = '오늘은 여기까지다.\n내일 다시 와라.';
        return;
      }

      usage.count += 1;
      saveUsage(usage);
      updateUsageUI(usage.count);

      result.classList.remove('show');
      result.textContent = '포춘베어가 생각 중이다...';

      try {
        const res = await fetch(
          'https://fortune-bear-backend.onrender.com/api/risk',
          { method: 'POST' }
        );

        const data = await res.json();

        setTimeout(() => {
          result.textContent = data.result;
          result.classList.add('show');
        }, 400);

      } catch (e) {
        result.textContent = '지금은 말해줄 수 없다.';
        result.classList.add('show');
      }
    });
  </script>

</body>
</html>
